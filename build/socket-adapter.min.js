/*!
 * @overview  Ember Data Socket Adapter
 * @copyright Copyright 2014 Collectrium LLC.
 * @author Andrew Fan <andrew.fan@upsilonit.com>
 */
// v0.1.3
// 9929954 (2014-04-11 04:20:32 -0700)


!function(a){var b,c,d,e;!function(){var a={},f={};b=function(b,c,d){a[b]={deps:c,callback:d}},e=d=c=function(b){function d(a){if("."!==a.charAt(0))return a;for(var c=a.split("/"),d=b.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(e._eak_seen=a,f[b])return f[b];if(f[b]={},!a[b])throw new Error("Could not find module "+b);for(var g,h=a[b],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)k.push("exports"===i[l]?g={}:c(d(i[l])));var n=j.apply(this,k);return f[b]=g||n}}(),b("socket-adapter/adapter",["exports"],function(a){"use strict";var b=Ember.get,c=Ember.set,d=Ember.EnumerableUtils.forEach,e=DS.RESTAdapter.extend({socketAddress:"http://api.collectrium.websocket:5000",socketConnections:null,bulkOperationsSupport:!0,generateRequestId:function(){var a=function(){return Math.floor(65536*Math.random()).toString(16)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getConnection:function(a,d){1===arguments.length&&(d={}),a instanceof Object&&(d=a,a="/");var e=b(this,"socketConnections"),f=b(e,a),g=this.get("socketAddress");return f||(g+="/","/"!==a&&(g=g+a+"/"),f=io.connect(g,d),c(e,a,f)),f},send:function(a,b,c){var d=this.getConnection(a.typeKey);return c instanceof Object||(c={}),c.request_id=this.generateRequestId(),new Ember.RSVP.Promise(function(a){d.emit(b,c),d.on(b,function(b){b.request_id===c.request_id&&Ember.run(null,a,b.payload)})},"DS: SocketAdapter#emit "+b+" to "+a.typeKey)},findAll:function(a,b){return this.send(b,"READ_LIST")},findQuery:function(a,b,c){return this.send(b,"READ_LIST",c)},find:function(a,b,c){return this.send(b,"READ",{id:c})},createRecord:function(a,b,c){var d=a.serializerFor(b.typeKey),e=d.serialize(c,{includeId:!0});return this.send(b,"CREATE",e)},createRecords:function(a,b,c){var e=a.serializerFor(b.typeKey),f=[];return d(c,function(a){f.push(e.serialize(a))}),this.send(b,"CREATE_LIST",f)},updateRecord:function(a,b,c){var d=a.serializerFor(b.typeKey),e=d.serialize(c,{includeId:!0});return this.send(b,"UPDATE",e)},updateRecords:function(a,b,c){var e=a.serializerFor(b.typeKey),f=[];return d(c,function(a){f.push(e.serialize(a,{includeId:!0}))}),this.send(b,"UPDATE_LIST",f)},deleteRecord:function(a,c,d){var e=b(d,"id");return this.send(c,"DELETE",{id:e})},deleteRecords:function(a,c,e){var f=[];return d(e,function(a){f.push(b(a,"id"))}),this.send(c,"DELETE_LIST",f)},openSocket:function(){c(this,"socketConnections",Ember.Object.create()),this.getConnection({resource:"handshake"})}.on("init")});a["default"]=e}),b("socket-adapter/main",["ember-data-socket-adapter/serializer","ember-data-socket-adapter/adapter","ember-data-socket-adapter/store","exports"],function(a,b,c,d){"use strict";var e,f=a["default"],g=b["default"],h=c["default"],i="0.1.3";"undefined"==typeof e&&(e=Ember.Namespace.create({VERSION:i,Adapter:g,Serializer:f,Store:h}),Ember.libraries&&Ember.libraries.registerCoreLibrary("Socket Adapter",e.VERSION)),d["default"]=e}),b("socket-adapter/serializer",["exports"],function(a){"use strict";DS.SocketSerializer=DS.RESTSerializer.extend({}),a["default"]=DS.SocketSerializer}),b("socket-adapter/store",["exports"],function(a){"use strict";function b(a){return a&&"function"==typeof a.then}function c(a,b,c){return a.lookup("serializer:"+b)||a.lookup("serializer:application")||a.lookup("serializer:"+c)||a.lookup("serializer:-default")}function d(a,b){var d=a.serializer,e=a.defaultSerializer,f=a.container;return f&&void 0===d&&(d=c(f,b.typeKey,e)),(null===d||void 0===d)&&(d={extract:function(a,b,c){return c}}),d}function e(a,c,e,f){var h=f.constructor,i=a[e](c,h,f),j=d(a,h),k="DS: Extract and notify about "+e+" completion of "+f;return Ember.assert("Your adapter's '"+e+"' method must return a promise, but it returned "+i,b(i)),i.then(function(a){var b;return b=a?j.extract(c,h,a,g(f,"id"),e):a,c.didSaveRecord(f,b),f},function(a){throw a instanceof DS.InvalidError?c.recordWasInvalid(f,a.errors):c.recordWasError(f,a),a},k)}function f(a,c,e,f,g){var i=a[e](c,f,g),j=d(a,f),k="DS: Extract and notify about "+e+" completion of "+g.length+" of type "+f.typeKey;return Ember.assert("Your adapter's '"+e+"' method must return a promise, but it returned "+i,b(i)),i.then(function(a){return a&&(e=e.substring(0,e.length-1),h(g,function(b){var d;d=a?j.extract(c,f,a,null,e):a,c.didSaveRecord(b,d)},this)),g},function(a){throw h(g,function(b){a instanceof DS.InvalidError?c.recordWasInvalid(b,a.errors):c.recordWasError(b,a)},this),a},k)}var g=Ember.get,h=(Ember.set,Ember.EnumerableUtils.forEach),i=DS.Store.extend({flushPendingSave:function(){var a=this._pendingSave.slice();this._pendingSave=[];var b,c,d=[],i=[],j=[],k=[],l=["createRecord","deleteRecord","updateRecord"];if(h(a,function(a){var b,c,f,h=a[0],m=a[1],n=h.constructor,o=this.adapterFor(h.constructor);b=g(h,"isNew")?"createRecord":g(h,"isDeleted")?"deleteRecord":"updateRecord",g(o,"bulkOperationsSupport")?(f=l.indexOf(b),c=i.indexOf(n),-1===c&&(i.push(n),c=i.length-1,d[c]=[],j[c]=m,k[c]=this.adapterFor(h.constructor)),d[c][f]instanceof Array||(d[c][f]=[]),d[c][f].push(h)):m.resolve(e(o,this,b,h))},this),d.length)for(b=0;b<d.length;b++)for(c=0;c<l.length;c++)d[b][c]&&d[b][c].length&&j[b].resolve(f(k[b],this,l[c]+"s",i[b],d[b][c]))}});a["default"]=i}),a.SA=c("socket-adapter/main")["default"]}(Ember.lookup);