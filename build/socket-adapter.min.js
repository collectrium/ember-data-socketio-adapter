/*!
 * @overview  Ember Data Socket Adapter
 * @copyright Copyright 2014 Collectrium LLC.
 * @author Andrew Fan <andrew.fan@upsilonit.com>
 */
// v0.1.45
// 6bac7ca (2015-11-04 00:30:56 +0300)


!function(a){var b,c,d,e;!function(){var a={},f={};b=function(b,c,d){a[b]={deps:c,callback:d}},e=d=c=function(b){function d(a){if("."!==a.charAt(0))return a;for(var c=a.split("/"),d=b.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(e._eak_seen=a,f[b])return f[b];if(f[b]={},!a[b])throw new Error("Could not find module "+b);for(var g,h=a[b],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)"exports"===i[l]?k.push(g={}):k.push(c(d(i[l])));var n=j.apply(this,k);return f[b]=g||n,f[b]}}(),b("socket-adapter/adapter",["exports"],function(a){"use strict";var b=Ember.get,c=Ember.set,d=Ember.EnumerableUtils.forEach,e=DS.RESTAdapter.extend({socketAddress:"http://api.collectrium.websocket:5000",bulkOperationsSupport:{createRecord:!0,updateRecord:!1,deleteRecord:!0},updateAsPatch:!0,coalesceFindRequests:!0,socketConnections:Ember.Object.create(),requestsPool:[],generateRequestId:function(){var a=function(){return Math.floor(65536*Math.random()).toString(16)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getConnection:function(a,e){var f=a.typeKey&&a.store,g=b(this,"socketAddress")+"/",h=b(this,"requestsPool");a=a.typeKey;var i=b(this,"socketConnections"),j=a&&b(i,a),k=this.onConnectFailed,l=this.onError,m=this;return 1===arguments.length&&(e={}),a||(e=arguments[0]),j?!j.hasOwnProperty("socket")||j.socket.connected||j.socket.connecting||j.socket.connect():(a&&(g=g+a.decamelize()+"/"),j=io.connect(g,e),a?(j.on("message",function(b){if(b.hasOwnProperty("errors")){if(b.request_id&&h[b.request_id]){var c=h[b.request_id].reject;delete b.request_id,delete h[b.request_id],Ember.run(null,c,b)}}else if(b.request_id&&h[b.request_id]){var e=h[b.request_id].resolve;delete b.request_id,delete h[b.request_id],Ember.run(null,e,b)}else f.trigger("notification",b),b.ids?d(b.ids,function(b){var c=f.getById(a,b);f.unloadRecord(c)}):b.hasOwnProperty("payload")&&f.pushPayload(a,b.payload)}),c(i,a,j)):(j.on("connect_failed",function(a){k&&k.call(m,a)}),j.on("error",function(a){l&&l.call(m,a)}))),j},send:function(a,c,d){var e=this.getConnection(a),f=b(this,"requestsPool"),g=this.generateRequestId(),h=Ember.RSVP.defer("DS: SocketAdapter#emit "+c+" to "+a.typeKey);return d instanceof Object||(d={}),h.requestType=c,d.request_id=g,f[g]=h,e.emit(c,d),h.promise},findAll:function(a,b){return this.send(b,"READ_LIST")},findQuery:function(a,b,c){return this.send(b,"READ_LIST",c)},findMany:function(a,b,c){return this.send(b,"READ_LIST",{query:{id__in:c}})},find:function(a,b,c){var d=a.modelFor(b),e={id:c};return d._findByIdParams&&(d._findByIdParams.include&&(e.include=d._findByIdParams.include),d._findByIdParams.fields&&(e.fields=d._findByIdParams.fields)),this.send(b,"READ",e)},createRecord:function(a,b,c){var d=a.serializerFor(b.typeKey),e={};return e[b.typeKey.decamelize()]=d.serialize(c),this.send(b,"CREATE",e)},createRecords:function(a,b,c){var e=a.serializerFor(b.typeKey),f={};return f[b.typeKey.decamelize()]=[],d(c,function(a){f[b.typeKey.decamelize()].push(e.serialize(a))}),this.send(b,"CREATE_LIST",f)},updateRecord:function(a,c,d){var e,f=a.serializerFor(c.typeKey),g={};return e=f.serialize(d,{includeId:!0}),b(this,"updateAsPatch")&&(e=this.filterUnchangedParams(e,d)),g[c.typeKey.decamelize()]=e,this.send(c,"UPDATE",g)},filterUnchangedParams:function(a,c){a=Ember.copy(a);var d=b(c,"data"),e=a.id;return Ember.keys(d).forEach(function(b){a[b]===d[b]&&delete a[b]}),a.id=e,a},updateRecords:function(a,b,c){var e=a.serializerFor(b.typeKey),f={};return f[b.typeKey.decamelize()]=[],d(c,function(a){f[b.typeKey.decamelize()].push(e.serialize(a,{includeId:!0}))}),this.send(b,"UPDATE_LIST",f)},deleteRecord:function(a,c,d){var e=b(d,"id");return this.send(c,"DELETE",{id:e})},deleteRecords:function(a,c,e){var f={ids:[]};return d(e,function(a){f.ids.push(b(a,"id"))}),this.send(c,"DELETE_LIST",f)},openSocket:function(){var a={resource:"handshake"};this.version&&(a.query="version="+this.version),this.getConnection(a)}.on("init")});a["default"]=e}),b("socket-adapter/main",["socket-adapter/serializer","socket-adapter/adapter","socket-adapter/store","exports"],function(a,b,c,d){"use strict";var e,f=a["default"],g=b["default"],h=c["default"],i="0.1.45";"undefined"==typeof e&&(e=Ember.Namespace.create({VERSION:i,Adapter:g,Serializer:f,Store:h}),Ember.libraries&&Ember.libraries.registerCoreLibrary("Socket Adapter",e.VERSION)),d["default"]=e}),b("socket-adapter/serializer",["exports"],function(a){"use strict";var b=Ember.get,c=DS.RESTSerializer.extend({extractFindQuery:function(a,b,c){return this.extractArray(a,b,c.payload)},extractFindAll:function(a,b,c){return this.extractArray(a,b,c.payload)},extractFindMany:function(a,b,c){return this.extractArray(a,b,c.payload)},extractCreateRecords:function(a,b,c){return this.extractArray(a,b,c)},extractUpdateRecords:function(a,b,c){return this.extractArray(a,b,c)},extractDeleteRecords:function(a,b,c){return this.extractArray(a,b,c)},serialize:function(a,b){var c=a._createSnapshot?a._createSnapshot():a,d=this._super(c,b);return this.filterFields(d,c)},filterFields:function(a,c){var d,e=Object.keys(b(c,"data")),f=Object.keys(a),g={};return b(c,"isNew")?g=a:f.forEach(function(b){d=c.record.relationshipFor(b),(e.contains(b)||(!d||"hasMany"!==d.kind)&&null!==a[b])&&(g[b]=a[b])}),g}});a["default"]=c}),b("socket-adapter/store",["exports"],function(a){"use strict";function b(a,b,c){return a.lookup("serializer:"+b)||a.lookup("serializer:application")||a.lookup("serializer:"+c)||a.lookup("serializer:-default")}function c(a,c){var d=a.serializer,e=a.defaultSerializer,f=a.container;return f&&void 0===d&&(d=b(f,c.typeKey,e)),(null===d||void 0===d)&&(d={extract:function(a,b,c){return c}}),d}function d(a,b,d,e){var f=e.constructor,g=a[d](b,f,e),h=c(a,f),j="DS: Extract and notify about "+d+" completion of "+e;return g.then(function(a){var c;return b._adapterRun(function(){c=a?h.extract(b,f,a,i(e,"id"),d):a,b.didSaveRecord(e,c)}),e},function(a){throw a instanceof DS.InvalidError?b.recordWasInvalid(e,a.errors):b.recordWasError(e,a),a},j)}function e(a,b){return m.create({promise:l.cast(a,b)})}function f(a){return null===a?null:a+""}function g(a,b,d,e,f){var g=a[d](b,e,f),h=c(a,e),i="DS: Extract and notify about "+d+" completion of "+f.length+" of type "+e.typeKey;return g.then(function(a){var c;return c=a?h.extract(b,e,a,null,d):a,k(f,function(a,d){b.didSaveRecord(a,c&&c[d])}),f},function(a){throw k(f,function(c){a instanceof DS.InvalidError?b.recordWasInvalid(c,a.errors):b.recordWasError(c,a)}),a},i)}function h(a,b,d,e,f){var g=a.findQuery(b,d,e,f),h=c(a,d),i="DS: Handle Adapter#findQuery of "+d;return l.cast(g,i).then(function(a){var c=h.extract(b,d,a,null,"findQuery");return f.load(c),f},null,"DS: Extract payload of findQuery "+d)}var i=Ember.get,j=Ember.set,k=Ember.EnumerableUtils.forEach,l=Ember.RSVP.Promise,m=Ember.ArrayProxy.extend(Ember.PromiseProxyMixin),n=DS.Store.extend(Ember.Evented,{removeIdsFromStore:function(a){var b;if(a instanceof Array)for(b=0;b>a.length;b++);},find:function(a,b){return 1===arguments.length?this.findAll(a):"object"===Ember.typeOf(b)?e(this.findQuery(a,b).then(function(a){return Ember.ArrayProxy.create({content:a.get("content"),meta:a.get("meta"),query:a.get("query"),type:a.get("type"),_APRA:a,addObject:function(a){this._APRA.manager.updateRecordArray(this._APRA,null,null,a)}})})):this.findById(a,f(b))},findQuery:function(a,b){a=this.modelFor(a);var c=this.recordArrayManager.createAdapterPopulatedRecordArray(a,b),d=this.adapterFor(a);return e(h(d,this,a,b,c))},filter:function(a,b,c){var d;3===arguments.length?d=this.findQuery(a,b):2===arguments.length&&(c=b),a=this.modelFor(a);var f=this.recordArrayManager.createFilteredRecordArray(a,c);return d=d||l.cast(f),e(d.then(function(a){var b=a.meta;return b&&j(f,"meta",b),f},null,"DS: Store#filter of "+a))},flushPendingSave:function(){var a=this._pendingSave.slice();this._pendingSave=[];var b,c,e,f=[],h=[],j=[],l=[],m=["createRecord","deleteRecord","updateRecord"];if(k(a,function(a){var b,c,e,g,k=a[0],n=a[1],o=k.constructor,p=this.adapterFor(k.constructor);c=i(k,"isNew")?"createRecord":i(k,"isDeleted")?"deleteRecord":"updateRecord",b=i(p,"bulkOperationsSupport")[c],b?(g=m.indexOf(c),e=h.indexOf(o),-1===e&&(h.push(o),e=h.length-1,f[e]=[],j[e]=[],l[e]=this.adapterFor(k.constructor)),j[e].push(n),f[e][g]instanceof Array||(f[e][g]=[]),f[e][g].push(k)):n.resolve(d(p,this,c,k))},this),f.length)for(c=0;c<f.length;c++)for(e=0;e<m.length;e++)f[c][e]&&f[c][e].length&&(1===f[c][e].length?j[c][0].resolve(d(l[c],this,m[e],f[c][e][0])):(b=j[c],g(l[c],this,m[e].pluralize(),h[c],f[c][e]).then(function(a){k(a,function(a,c){b[c].resolve(a)})})))}});a["default"]=n}),a.SA=c("socket-adapter/main")["default"]}(Ember.lookup);